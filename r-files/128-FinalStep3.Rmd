---
title: "126-Final"
author: "Ali Abuzaid"
date: "2025-03-04"
output: pdf_document
---
:::callout
<div style="text-align: center">
<span style="color: blue;"> ** 
- Angelina Song    (angelinasong)
- STUDENT 2    (NetID 2)
- STUDENT 3    (NetID 3)
- STUDENT 4    (NetID 4)
- STUDENT 5    (NetID 5)
**</span> 
</div>
:::
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Abstract

# Introduction

Body Mass Index (BMI) is commonly believed to be influenced by various lifestyle and dietary factors, including food consumption habits, hydration levels, and alcohol intake. This study aims to analyze the relationship between different consumption behaviors and BMI through multiple linear regression to determine whether any particular habit *actually* a significant impact. Using a dataset containing information on dietary patterns from the [UCI Machine Learning Repository] (https://archive.ics.uci.edu/dataset/544/estimation+of+obesity+levels+based+on+eating+habits+and+physical+condition), we explore the link between consumption habits and BMI.

In this model, we include predictors such as the frequency of consuming high-caloric foods (FAVC), eating between meals (CAEC), alcohol consumption (CALC), and daily calorie monitoring (SCC), water intake (CH2O), and vegetable consumption (FCVC).

### Hypothesis
$$
\begin{aligned}
H_0&: \text{No particular consumption habit has any significant effect on BMI} \\
H_A&: \text{At least 1 consumption habit has a significant effect on BMI}
\end{aligned}
$$
# Data Processing
###Initial Regression Analysis
```{r}
data <- read.csv("../data/data-cleaned.csv")

# lambda <- 0.6
# data$BMI <- (data$BMI^lambda - 1) / lambda
model_eating <- lm(BMI~FAVC+ FCVC+ NCP+ CAEC+ CH2O+ SCC+ CALC,data)
s <- summary(model_eating)
knitr::kable(matrix(
  c(s$fstatistic[[1]],s$fstatistic[[2]],s$fstatistic[[3]],
    pf(s$fstatistic[[1]],s$fstatistic[[2]],s$fstatistic[[3]],
       lower.tail = FALSE),s$adj.r.squared),byrow = TRUE,nrow = 1
), col.names = c("F-stat","df1","df2","p-val", "R^2"),
caption="Overall Model Performance", digits = 200)
knitr::kable(s$coefficients, caption="Coefficient Analysis", digits=200)

```
### Model Adjustments
First, we drop insignificant parameters from the model and combine certain levels in categorical variables.
```{r}
data$CALC[data$CALC=="Sometimes"] <- "Yes"
data$CALC[data$CALC=="Frequently"] <- "Yes"

data$CAEC[data$CAEC=="Sometimes"] <- "Rarely"
data$CAEC[data$CAEC=="no"] <- "Rarely"

model_eating_u <- lm(BMI~FAVC+ FCVC+ CAEC+ CH2O+ SCC+ CALC,data) # combined levels with 6 predictors
s<-summary(model_eating_u)
knitr::kable(matrix(
  c(s$fstatistic[[1]],s$fstatistic[[2]],s$fstatistic[[3]],
    pf(s$fstatistic[[1]],s$fstatistic[[2]],s$fstatistic[[3]],
       lower.tail = FALSE),s$adj.r.squared),byrow = TRUE,nrow = 1
), col.names = c("F-stat","df1","df2","p-val", "R^2"),
caption="Overall Model Performance", digits = 200)
knitr::kable(s$coefficients, caption="Coefficient Analysis", digits=200)
```

### Model Assumptions

Next, we check this updated model to see if the residuals match our assumptions of:
1. Normality

2. Homoscedasticity

3. Independence

4. Linearity

```{r, fig.width=8, fig.height=8}
par(mfrow = c(2, 2))
plot(model_eating_u)
```




Based on these plots, we can observe the following:
```{r echo=FALSE}
output <- matrix(
  c("Residuals vs. Fitted", "Funnel Shape indicates heteroscedasticity. No curvature to indicate nonlinearity",
    "Q-Q", "Vast majority of the points are on the line -- apears normal",
    "Scale-Location", "Funnel shape indicates heteroscedasticity",
    "residuals vs. Leverage", "Entry 345 possible influential point"),
  byrow=TRUE,nrow=4
)
knitr::kable(output,caption="Plot Interpretation")
```
Therefore, a transformation is in order. We begin with a box-cox transformation on the response variable.
```{r, fig.width=8, fig.height=8}
library(MASS)
suppressWarnings({
bc <- boxcox(model_eating_u, lambda=seq(-2,2,by=0.1),plotit=FALSE)
})
best_lambda <- bc$x[which.max(bc$y)]

data$BMI <- (data$BMI^best_lambda - 1) / best_lambda
model_eating_u <- lm(BMI~FAVC+ CAEC+ SCC+ CALC+ FCVC+ CH2O,data)
par(mfrow = c(2, 2))
```

# Exploratory Data Analysis
### Null values
For our dataset, we did not have any missing or null values. 

### Summary Statistics
```{r}
#Quantitative Summary Statistics
quant_vars <- obesityData %>%
  select(where(is.numeric))
summary_stats <-summary(quant_vars)

kable(summary_stats, col.names = colnames(quant_vars), 
      caption = "Summary Statistics for Quantitative Variables")

#Qualitative Summary Statistics


```


### Boxplots & Scatterplots

For each variable in the multiple linear regression, we first created boxplots for categorical predictors and scatterplots for continuous predictors to display and to gain a better understanding the individual relationships between our variables.

```{r}
# categorical variables 
par(mfrow = c(2,3))
boxplot(BMI ~ FAVC, data = data, col = "lightgreen", 
        main = "BMI vs FAVC", 
        xlab = 'Do you eat high caloric food frequently?')

boxplot(BMI ~ CAEC, data = data, col = "lightblue", 
        main = "BMI vs CAEC",
        xlab = 'Do you eat any food between meals?')


boxplot(BMI ~ CALC, data = data, col = "pink", 
        main = "BMI vs CALC",
        xlab = 'How often do you drink alcohol?')


boxplot(BMI ~ SCC, data = data, col = "burlywood", 
        main = "BMI vs SCC",
        xlab = 'Do you monitor the calories you eat daily?')

# continuous variables
plot(BMI ~ CH2O, data = data, col = "cadetblue2", main = "BMI vs CH20",
        xlab = 'How often do you drink water?')
model_ch2o <- lm(BMI ~ CH2O, data = data)
abline(model_ch2o, col = "blue", lwd = 2)

plot(BMI ~ FCVC, data = data, col = "darkolivegreen1", main = "BMI vs FCVC",
        xlab = 'Do you usually eat vegetables in your meals?')
model_fcvc <- lm(BMI ~ FCVC, data = data)
abline(model_fcvc, col = "darkgreen", lwd = 2)

```
From this EDA, we can see that for the categorical variables already have some effect on the BMI.

Predictors associated with higher BMI:

- frequently drinking alcohol (CALC)
- not counting calories (SCC)
- frequent consumption of high calorie food (FAVC)


>Issue here bc the how often you drink alchol is yes/no from merging rows


### Correlation plot of CH2O and FCVC
```{r}
#taking the correlation plot of the two continuous variables

library(corrplot)
corrplot_data <- data[, c("BMI", "CH2O", "FCVC")]
cor_matrix <- cor(corrplot_data)
corrplot(cor_matrix, method="number")
```

# Visualizations

# Explain your regression model
```{r}
full_model <- lm(BMI ~ FAVC + FCVC +NCP+ CAEC 
                 , data = data)
summary(full_model)
```
###Step Wise model starting with intercept
```{r}
model_stepwise <- step(lm(BMI ~1, data = data), direction = "both", scope = formula(full_model))
```
###Backwards Model
```{r}
backward_model <- step(full_model, direction = "backward", )
backward_model
```

###Forward Model
```{r}
forward_model <- step(lm(BMI ~1, data = data), direction = "forward", scope = formula(full_model))
forward_model
```
All versions ended up with the full model as the end result.

# Interpret your results

# Check assumptions
```{r}


```
# Recommendations

# Conclusion
